<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LibreCrawl - SEO Spider</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.28.1/cytoscape.min.js"></script>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <h1 class="app-title">LibreCrawl</h1>
                <div class="header-actions">
                    <span id="userInfo" style="margin-right: 15px; color: #6b7280; font-size: 14px;"></span>
                    <button class="btn btn-secondary" onclick="openDashboard()">Dashboard</button>
                    <button class="btn btn-secondary" onclick="openSettings()">Settings</button>
                    <button class="btn btn-secondary" onclick="exportData()">Export</button>
                    <button class="btn btn-success" id="saveCrawlBtn" onclick="saveCrawl()" disabled>Save Crawl</button>
                    <button class="btn btn-primary" id="loadCrawlBtn" onclick="loadCrawl()">Load Crawl</button>
                    <button class="btn btn-danger" onclick="logout()" style="margin-left: 10px;">Logout</button>
                </div>
            </div>
        </header>

        <!-- URL Input Section -->
        <section class="url-section">
            <div class="url-container">
                <div class="input-group">
                    <label for="urlInput" class="input-label">URL to Crawl</label>
                    <input
                        type="url"
                        id="urlInput"
                        class="url-input"
                        placeholder="https://example.com"
                        onkeypress="handleUrlKeypress(event)"
                    >
                </div>
                <div class="control-buttons">
                    <button id="startBtn" class="btn btn-primary" onclick="toggleCrawl()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M8 5v14l11-7z"/>
                        </svg>
                        Start
                    </button>
                    <button id="stopBtn" class="btn btn-danger" onclick="stopCrawl()" disabled>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <rect x="6" y="6" width="12" height="12"/>
                        </svg>
                        Stop
                    </button>
                    <button id="clearBtn" class="btn btn-secondary" onclick="clearCrawlData()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                        Clear
                    </button>
                </div>
            </div>
            <div class="progress-container" id="progressContainer" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span class="progress-text" id="progressText">Initializing...</span>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-section">
                    <h3 class="sidebar-title">Filters</h3>
                    <div class="filter-tree">
                        <div class="filter-group">
                            <div class="filter-item" onclick="toggleFilter('internal')">
                                <span class="filter-name">Internal</span>
                                <span class="filter-count" id="internal-count">0</span>
                            </div>
                            <div class="filter-item" onclick="toggleFilter('external')">
                                <span class="filter-name">External</span>
                                <span class="filter-count" id="external-count">0</span>
                            </div>
                        </div>

                        <div class="filter-group">
                            <div class="filter-header">Response Codes</div>
                            <div class="filter-subgroup">
                                <div class="filter-item" onclick="toggleFilter('2xx')">
                                    <span class="filter-name">2xx Success</span>
                                    <span class="filter-count" id="2xx-count">0</span>
                                </div>
                                <div class="filter-item" onclick="toggleFilter('3xx')">
                                    <span class="filter-name">3xx Redirect</span>
                                    <span class="filter-count" id="3xx-count">0</span>
                                </div>
                                <div class="filter-item" onclick="toggleFilter('4xx')">
                                    <span class="filter-name">4xx Client Error</span>
                                    <span class="filter-count" id="4xx-count">0</span>
                                </div>
                                <div class="filter-item" onclick="toggleFilter('5xx')">
                                    <span class="filter-name">5xx Server Error</span>
                                    <span class="filter-count" id="5xx-count">0</span>
                                </div>
                            </div>
                        </div>

                        <div class="filter-group">
                            <div class="filter-header">Content Type</div>
                            <div class="filter-subgroup">
                                <div class="filter-item" onclick="toggleFilter('html')">
                                    <span class="filter-name">HTML</span>
                                    <span class="filter-count" id="html-count">0</span>
                                </div>
                                <div class="filter-item" onclick="toggleFilter('css')">
                                    <span class="filter-name">CSS</span>
                                    <span class="filter-count" id="css-count">0</span>
                                </div>
                                <div class="filter-item" onclick="toggleFilter('js')">
                                    <span class="filter-name">JavaScript</span>
                                    <span class="filter-count" id="js-count">0</span>
                                </div>
                                <div class="filter-item" onclick="toggleFilter('images')">
                                    <span class="filter-name">Images</span>
                                    <span class="filter-count" id="images-count">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">Statistics</h3>
                    <div class="stats-container">
                        <div class="stat-item">
                            <span class="stat-label">URLs Discovered</span>
                            <span class="stat-value" id="discoveredCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">URLs Crawled</span>
                            <span class="stat-value" id="crawledCount">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Crawl Depth</span>
                            <span class="stat-value" id="crawlDepth">0</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Speed</span>
                            <span class="stat-value" id="crawlSpeed">0 URLs/sec</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-title">Data Size</h3>
                    <div class="stats-container">
                        <div class="stat-item">
                            <span class="stat-label">Crawl Data</span>
                            <span class="stat-value" id="memCurrent">0 MB</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Per URL</span>
                            <span class="stat-value" id="memPeak">0 KB/URL</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">Est. for 1M URLs</span>
                            <span class="stat-value" id="memEstimate1M">0 MB</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">System Available</span>
                            <span class="stat-value" id="memAvailable">0 MB</span>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Content Area -->
            <div class="content-area">
                <div class="tab-container">
                    <div class="tab-header">
                        <button class="tab-btn active" onclick="switchTab('overview')">Overview</button>
                        <button class="tab-btn" onclick="switchTab('internal')">Internal</button>
                        <button class="tab-btn" onclick="switchTab('external')">External</button>
                        <button class="tab-btn" onclick="switchTab('status-codes')">Status Codes</button>
                        <button class="tab-btn" onclick="switchTab('links')">Links</button>
                        <button class="tab-btn" onclick="switchTab('issues')">Issues</button>
                        <button class="tab-btn" onclick="switchTab('pagespeed')">PageSpeed</button>
                        <button class="tab-btn" onclick="switchTab('visualization')">Visualization</button>
                    </div>

                    <div class="tab-content">
                        <div id="overview-tab" class="tab-pane active">
                            <div class="table-container">
                                <table class="data-table" id="overviewTable">
                                    <thead>
                                        <tr>
                                            <th>Address</th>
                                            <th>Status</th>
                                            <th>Title</th>
                                            <th>Meta Desc</th>
                                            <th>H1</th>
                                            <th>Words</th>
                                            <th>Response (ms)</th>
                                            <th>Analytics</th>
                                            <th>OG Tags</th>
                                            <th>JSON-LD</th>
                                            <th>Links (Int/Ext)</th>
                                            <th>Images</th>
                                            <th>JS</th>
                                            <th>Details</th>
                                            <th>Jina</th>
                                        </tr>
                                    </thead>
                                    <tbody id="overviewTableBody">
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="internal-tab" class="tab-pane">
                            <div class="table-container">
                                <table class="data-table" id="internalTable">
                                    <thead>
                                        <tr>
                                            <th>Address</th>
                                            <th>Status</th>
                                            <th>Content Type</th>
                                            <th>Size</th>
                                            <th>Title</th>
                                            <th>Jina</th>
                                        </tr>
                                    </thead>
                                    <tbody id="internalTableBody">
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="external-tab" class="tab-pane">
                            <div class="table-container">
                                <table class="data-table" id="externalTable">
                                    <thead>
                                        <tr>
                                            <th>Address</th>
                                            <th>Status</th>
                                            <th>Content Type</th>
                                            <th>Size</th>
                                            <th>Title</th>
                                            <th>Jina</th>
                                        </tr>
                                    </thead>
                                    <tbody id="externalTableBody">
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="status-codes-tab" class="tab-pane">
                            <div class="table-container">
                                <table class="data-table" id="statusCodesTable">
                                    <thead>
                                        <tr>
                                            <th>Status Code</th>
                                            <th>Status</th>
                                            <th>Count</th>
                                            <th>Percentage</th>
                                        </tr>
                                    </thead>
                                    <tbody id="statusCodesTableBody">
                                        <!-- Data will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div id="links-tab" class="tab-pane">
                            <div class="links-tab-scroll-container">
                                <div class="links-sections">
                                    <div class="links-section">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                            <h3 class="links-section-title">üîó Internal Links</h3>
                                            <div style="display: flex; gap: 10px; align-items: center;">
                                                <select onchange="filterInternalLinks(this.value)" style="padding: 6px 12px; border-radius: 6px; border: 1px solid #4b5563; background: #1f2937; color: white; font-size: 13px;">
                                                    <option value="all">All Status Codes</option>
                                                    <option value="2xx">2xx Success</option>
                                                    <option value="3xx">3xx Redirect</option>
                                                    <option value="4xx">4xx Client Error</option>
                                                    <option value="5xx">5xx Server Error</option>
                                                </select>
                                                <input type="text" placeholder="Search..." oninput="searchInternalLinks(this.value)" style="padding: 6px 12px; border-radius: 6px; border: 1px solid #4b5563; background: #1f2937; color: white; font-size: 13px; width: 200px;">
                                            </div>
                                        </div>
                                        <div class="table-container internal-links-container">
                                            <table class="data-table" id="internalLinksTable">
                                                <thead>
                                                    <tr>
                                                        <th>Source URL</th>
                                                        <th>Target URL</th>
                                                        <th>Status</th>
                                                        <th>Anchor Text</th>
                                                        <th>Placement</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="internalLinksTableBody">
                                                    <!-- Internal links will be populated here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>

                                    <div class="links-section">
                                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                            <h3 class="links-section-title">üåê External Links</h3>
                                            <div style="display: flex; gap: 10px; align-items: center;">
                                                <select onchange="filterExternalLinks(this.value)" style="padding: 6px 12px; border-radius: 6px; border: 1px solid #4b5563; background: #1f2937; color: white; font-size: 13px;">
                                                    <option value="all">All Status Codes</option>
                                                    <option value="2xx">2xx Success</option>
                                                    <option value="3xx">3xx Redirect</option>
                                                    <option value="4xx">4xx Client Error</option>
                                                    <option value="5xx">5xx Server Error</option>
                                                </select>
                                                <input type="text" placeholder="Search..." oninput="searchExternalLinks(this.value)" style="padding: 6px 12px; border-radius: 6px; border: 1px solid #4b5563; background: #1f2937; color: white; font-size: 13px; width: 200px;">
                                            </div>
                                        </div>
                                        <div class="table-container external-links-container">
                                            <table class="data-table" id="externalLinksTable">
                                                <thead>
                                                    <tr>
                                                        <th>Source URL</th>
                                                        <th>Target URL</th>
                                                        <th>Status</th>
                                                        <th>Domain</th>
                                                        <th>Placement</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="externalLinksTableBody">
                                                    <!-- External links will be populated here -->
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="issues-tab" class="tab-pane">
                            <!-- Severity Filters -->
                            <div class="filter-bar" style="margin-bottom: 20px; display: flex; gap: 10px; justify-content: center; align-items: center;">
                                <button class="filter-item active" onclick="filterIssues('all')" data-filter="all" style="background: #374151; border: 1px solid #4b5563; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.2s; font-size: 14px; font-weight: 500; min-width: 120px;">
                                    All Issues <span id="issues-all-count" style="opacity: 0.7;">(0)</span>
                                </button>
                                <button class="filter-item" onclick="filterIssues('error')" data-filter="error" style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #ef4444; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.2s; font-size: 14px; font-weight: 500; min-width: 100px;">
                                    <span>‚ùå</span> Errors <span id="issues-error-count" style="opacity: 0.7;">(0)</span>
                                </button>
                                <button class="filter-item" onclick="filterIssues('warning')" data-filter="warning" style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); color: #f59e0b; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.2s; font-size: 14px; font-weight: 500; min-width: 120px;">
                                    <span>‚ö†Ô∏è</span> Warnings <span id="issues-warning-count" style="opacity: 0.7;">(0)</span>
                                </button>
                                <button class="filter-item" onclick="filterIssues('info')" data-filter="info" style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); color: #3b82f6; padding: 8px 16px; border-radius: 6px; cursor: pointer; transition: all 0.2s; font-size: 14px; font-weight: 500; min-width: 90px;">
                                    <span>‚ÑπÔ∏è</span> Info <span id="issues-info-count" style="opacity: 0.7;">(0)</span>
                                </button>
                            </div>

                            <div class="table-container">
                                <table class="data-table" id="issuesTable">
                                    <thead>
                                        <tr>
                                            <th style="width: 35%;">URL</th>
                                            <th style="width: 10%;">Type</th>
                                            <th style="width: 15%;">Category</th>
                                            <th style="width: 20%;">Issue</th>
                                            <th style="width: 20%;">Details</th>
                                        </tr>
                                    </thead>
                                    <tbody id="issuesTableBody">
                                        <!-- Issues will be populated here -->
                                    </tbody>
                                </table>
                                <div class="empty-state" id="issuesEmptyState" style="display: none;">
                                    <div class="empty-state-content">
                                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <circle cx="12" cy="12" r="10"/>
                                            <path d="M12 8v4M12 16h0"/>
                                        </svg>
                                        <h3>No Issues Found</h3>
                                        <p>Start crawling to detect SEO issues and problems on your website.</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="pagespeed-tab" class="tab-pane">
                            <div class="pagespeed-container">
                                <div class="pagespeed-header">
                                    <h3>PageSpeed Insights Results</h3>
                                    <p class="pagespeed-description">Performance analysis for homepage and category pages (powered by Google PageSpeed Insights)</p>
                                </div>
                                <div id="pagespeedResults" class="pagespeed-results">
                                    <div class="pagespeed-placeholder">
                                        <p>üöÄ PageSpeed analysis will appear here after crawl completion</p>
                                        <p>Enable PageSpeed Analysis in settings to get Core Web Vitals and performance scores</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="visualization-tab" class="tab-pane">
                            <div class="visualization-container">
                                <div class="visualization-header">
                                    <h3>Site Structure Visualization</h3>
                                    <div class="visualization-controls">
                                        <select id="vizLayout" onchange="changeLayout(this.value)">
                                            <option value="cose">Force-Directed</option>
                                            <option value="breadthfirst">Hierarchical</option>
                                            <option value="circle">Circle</option>
                                            <option value="concentric">Concentric</option>
                                            <option value="grid">Grid</option>
                                        </select>
                                        <select id="vizFilter" onchange="filterVisualization(this.value)">
                                            <option value="all">All Pages</option>
                                            <option value="html">HTML Only</option>
                                            <option value="2xx">2xx Success</option>
                                            <option value="3xx">3xx Redirects</option>
                                            <option value="4xx">4xx Errors</option>
                                            <option value="5xx">5xx Errors</option>
                                        </select>
                                        <button class="btn btn-secondary" onclick="resetVisualization()">Reset View</button>
                                        <button class="btn btn-secondary" onclick="exportVisualizationImage()">Export PNG</button>
                                    </div>
                                </div>
                                <div id="cy" class="graph-container">
                                    <div class="graph-placeholder">
                                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                            <circle cx="12" cy="12" r="3"/>
                                            <circle cx="6" cy="6" r="2"/>
                                            <circle cx="18" cy="6" r="2"/>
                                            <circle cx="6" cy="18" r="2"/>
                                            <circle cx="18" cy="18" r="2"/>
                                            <line x1="12" y1="12" x2="6" y2="6"/>
                                            <line x1="12" y1="12" x2="18" y2="6"/>
                                            <line x1="12" y1="12" x2="6" y2="18"/>
                                            <line x1="12" y1="12" x2="18" y2="18"/>
                                        </svg>
                                        <h3>No Data Yet</h3>
                                        <p>Start crawling to visualize your site structure</p>
                                    </div>
                                </div>
                                <div class="visualization-legend">
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #10b981;"></span>
                                        <span>2xx Success</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #3b82f6;"></span>
                                        <span>3xx Redirect</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #f59e0b;"></span>
                                        <span>4xx Error</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #ef4444;"></span>
                                        <span>5xx Error</span>
                                    </div>
                                    <div class="legend-item">
                                        <span class="legend-color" style="background: #6b7280;"></span>
                                        <span>Other</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Status Bar -->
        <footer class="status-bar">
            <span id="statusText">Ready</span>
            <span id="crawlTime">00:00</span>
        </footer>
    </div>

    <!-- Settings Modal -->
    <!-- Dashboard Modal -->
    <div id="dashboardModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1200px;">
            <div class="modal-header">
                <h2>Crawl History</h2>
                <button class="modal-close" onclick="closeDashboard()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="dashboardContent" style="padding: 20px;">
                    <p style="text-align: center; color: #9ca3af;">Loading crawls...</p>
                </div>
            </div>
        </div>
    </div>

    <div id="settingsModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Settings</h2>
                <button class="modal-close" onclick="closeSettings()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-tabs">
                    <button class="settings-tab-btn active" onclick="switchSettingsTab('crawler')">Crawler</button>
                    <button class="settings-tab-btn" onclick="switchSettingsTab('requests')">Requests</button>
                    <button class="settings-tab-btn" onclick="switchSettingsTab('filters')">Filters</button>
                    <button class="settings-tab-btn" onclick="switchSettingsTab('export')">Export</button>
                    <button class="settings-tab-btn" onclick="switchSettingsTab('javascript')">JavaScript</button>
                    <button class="settings-tab-btn" onclick="switchSettingsTab('issues')">Issue Exclusion</button>
                    <button class="settings-tab-btn" onclick="switchSettingsTab('customcss')">Custom CSS</button>
                    <button class="settings-tab-btn" onclick="switchSettingsTab('advanced')">Advanced</button>
                </div>

                <!-- Crawler Settings -->
                <div id="crawler-settings" class="settings-tab-content active">
                    <h3>Crawler Configuration</h3>

                    <div class="setting-group">
                        <label for="maxDepth">Maximum Crawl Depth</label>
                        <input type="number" id="maxDepth" value="3" min="1" max="10">
                        <span class="setting-help">How deep to crawl from the starting URL</span>
                    </div>

                    <div class="setting-group">
                        <label for="maxUrls">Maximum URLs to Crawl</label>
                        <input type="number" id="maxUrls" value="5000000" min="1" max="5000000">
                        <span class="setting-help">Stop crawling after this many URLs</span>
                    </div>

                    <div class="setting-group">
                        <label for="crawlDelay">Crawl Delay (seconds)</label>
                        <input type="number" id="crawlDelay" value="1" min="0" max="60" step="0.1">
                        <span class="setting-help">Delay between requests to be respectful</span>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="followRedirects" checked>
                            Follow Redirects
                        </label>
                        <span class="setting-help">Follow 3xx redirects automatically</span>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="crawlExternalLinks">
                            Crawl External Links
                        </label>
                        <span class="setting-help">Include external domains in crawl</span>
                    </div>
                </div>

                <!-- Request Settings -->
                <div id="requests-settings" class="settings-tab-content">
                    <h3>HTTP Request Configuration</h3>

                    <div class="setting-group">
                        <label for="userAgent">User Agent</label>
                        <input type="text" id="userAgent" value="LibreCrawl/1.0 (Web Crawler)">
                        <span class="setting-help">User agent string sent with requests</span>
                    </div>

                    <div class="setting-group">
                        <label for="timeout">Request Timeout (seconds)</label>
                        <input type="number" id="timeout" value="10" min="1" max="120">
                        <span class="setting-help">How long to wait for a response</span>
                    </div>

                    <div class="setting-group">
                        <label for="retries">Retry Attempts</label>
                        <input type="number" id="retries" value="3" min="0" max="10">
                        <span class="setting-help">Number of retries for failed requests</span>
                    </div>

                    <div class="setting-group">
                        <label for="acceptLanguage">Accept Language</label>
                        <input type="text" id="acceptLanguage" value="en-US,en;q=0.9">
                        <span class="setting-help">Preferred language for responses</span>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="respectRobotsTxt" checked>
                            Respect robots.txt
                        </label>
                        <span class="setting-help">Check robots.txt before crawling</span>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="allowCookies" checked>
                            Allow Cookies
                        </label>
                        <span class="setting-help">Accept and send cookies</span>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="discoverSitemaps" checked>
                            Discover Sitemaps
                        </label>
                        <span class="setting-help">Automatically find and parse sitemap.xml files (including nested sitemaps)</span>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enablePageSpeed">
                            Enable PageSpeed Analysis
                        </label>
                        <span class="setting-help">Run Google PageSpeed Insights on homepage and 2 category pages after crawl completes</span>
                    </div>

                    <div class="setting-group">
                        <label for="googleApiKey">Google PageSpeed API Key</label>
                        <input type="password" id="googleApiKey" placeholder="Enter your Google PageSpeed Insights API key">
                        <span class="setting-help">
                            API key for higher rate limits (25k requests/day vs limited without key).
                            <a href="https://developers.google.com/speed/docs/insights/v5/get-started" target="_blank" style="color: #8b5cf6;">Get API key here</a>
                        </span>
                    </div>
                </div>

                <!-- Filter Settings -->
                <div id="filters-settings" class="settings-tab-content">
                    <h3>Content Filters</h3>

                    <div class="setting-group">
                        <label for="includeExtensions">Include File Extensions</label>
                        <input type="text" id="includeExtensions" value="html,htm,php,asp,aspx,jsp">
                        <span class="setting-help">Comma-separated list of extensions to crawl</span>
                    </div>

                    <div class="setting-group">
                        <label for="excludeExtensions">Exclude File Extensions</label>
                        <input type="text" id="excludeExtensions" value="pdf,doc,docx,zip,exe,dmg">
                        <span class="setting-help">Comma-separated list of extensions to skip</span>
                    </div>

                    <div class="setting-group">
                        <label for="includePatterns">Include URL Patterns</label>
                        <textarea id="includePatterns" rows="3" placeholder="One pattern per line (regex supported)"></textarea>
                        <span class="setting-help">Only crawl URLs matching these patterns</span>
                    </div>

                    <div class="setting-group">
                        <label for="excludePatterns">Exclude URL Patterns</label>
                        <textarea id="excludePatterns" rows="3" placeholder="One pattern per line (regex supported)"></textarea>
                        <span class="setting-help">Skip URLs matching these patterns</span>
                    </div>

                    <div class="setting-group">
                        <label for="maxFileSize">Maximum File Size (MB)</label>
                        <input type="number" id="maxFileSize" value="50" min="1" max="1000">
                        <span class="setting-help">Skip files larger than this size</span>
                    </div>

                    <h3 style="margin-top: 30px;">Duplication Detection</h3>

                    <div class="setting-group">
                        <label>
                            <input type="checkbox" id="enableDuplicationCheck" checked>
                            Enable Duplication Check
                        </label>
                        <span class="setting-help">Detect duplicate content across all crawled pages</span>
                    </div>

                    <div class="setting-group">
                        <label for="duplicationThreshold">Duplication Similarity Threshold</label>
                        <input type="number" id="duplicationThreshold" value="0.85" min="0" max="1" step="0.05">
                        <span class="setting-help">Content similarity threshold (0.0-1.0). Higher values = stricter matching. Default: 0.85 (85% similar)</span>
                    </div>
                </div>

                <!-- Export Settings -->
                <div id="export-settings" class="settings-tab-content">
                    <h3>Export Configuration</h3>

                    <div class="setting-group">
                        <label for="exportFormat">Default Export Format</label>
                        <select id="exportFormat">
                            <option value="csv">CSV</option>
                            <option value="xlsx">Excel (XLSX)</option>
                            <option value="json">JSON</option>
                            <option value="xml">XML</option>
                        </select>
                        <span class="setting-help">Default format for data exports</span>
                    </div>

                    <div class="setting-group">
                        <label>Export Fields</label>
                        <div class="checkbox-grid">
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="url" checked>
                                URL
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="status_code" checked>
                                Status Code
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="title" checked>
                                Title
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="meta_description" checked>
                                Meta Description
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="h1" checked>
                                H1 Tags
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="word_count">
                                Word Count
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="content_type">
                                Content Type
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="response_time">
                                Response Time
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="canonical_url">
                                Canonical URL
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="og_tags">
                                OpenGraph Tags
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="twitter_tags">
                                Twitter Cards
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="json_ld">
                                JSON-LD Data
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="analytics">
                                Analytics Tracking
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="internal_links">
                                Internal Links Count
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="external_links">
                                External Links Count
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="images">
                                Images Count
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="links_detailed">
                                Detailed Links Data (separate file)
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="lang">
                                Language
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="charset">
                                Charset
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="viewport">
                                Viewport
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="robots">
                                Robots Meta
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" name="exportFields" value="issues_detected">
                                Issues Detected (separate export)
                            </label>
                        </div>
                    </div>
                </div>

                <!-- JavaScript Settings -->
                <div id="javascript-settings" class="settings-tab-content">
                    <h3>JavaScript Rendering Configuration</h3>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableJavaScript">
                            Enable JavaScript Rendering
                        </label>
                        <span class="setting-help">Render pages with JavaScript for dynamic content (slower but more accurate)</span>
                    </div>

                    <div class="setting-group" id="jsSettings" style="display: none;">
                        <label for="jsWaitTime">JavaScript Wait Time (seconds)</label>
                        <input type="number" id="jsWaitTime" value="3" min="0" max="30" step="0.5">
                        <span class="setting-help">Time to wait for JavaScript to render after page load</span>
                    </div>

                    <div class="setting-group" id="jsTimeoutGroup" style="display: none;">
                        <label for="jsTimeout">Page Load Timeout (seconds)</label>
                        <input type="number" id="jsTimeout" value="30" min="5" max="120">
                        <span class="setting-help">Maximum time to wait for page to load</span>
                    </div>

                    <div class="setting-group" id="jsBrowserGroup" style="display: none;">
                        <label for="jsBrowser">Browser Engine</label>
                        <select id="jsBrowser">
                            <option value="chromium">Chromium (Recommended)</option>
                            <option value="firefox">Firefox</option>
                            <option value="webkit">WebKit (Safari)</option>
                        </select>
                        <span class="setting-help">Browser engine for JavaScript rendering</span>
                    </div>

                    <div class="setting-group" id="jsHeadlessGroup" style="display: none;">
                        <label class="checkbox-label">
                            <input type="checkbox" id="jsHeadless" checked>
                            Headless Mode
                        </label>
                        <span class="setting-help">Run browser without visible window (recommended for performance)</span>
                    </div>

                    <div class="setting-group" id="jsUserAgentGroup" style="display: none;">
                        <label for="jsUserAgent">JavaScript User Agent</label>
                        <input type="text" id="jsUserAgent" value="LibreCrawl/1.0 (Web Crawler with JavaScript)">
                        <span class="setting-help">User agent string for JavaScript-rendered pages</span>
                    </div>

                    <div class="setting-group" id="jsViewportGroup" style="display: none;">
                        <label>Browser Viewport Size</label>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <input type="number" id="jsViewportWidth" value="1920" min="800" max="4000" placeholder="Width">
                            <span>√ó</span>
                            <input type="number" id="jsViewportHeight" value="1080" min="600" max="3000" placeholder="Height">
                        </div>
                        <span class="setting-help">Browser window size for rendering (affects responsive layouts)</span>
                    </div>

                    <div class="setting-group" id="jsConcurrencyGroup" style="display: none;">
                        <label for="jsMaxConcurrentPages">Max Concurrent Browser Pages</label>
                        <input type="number" id="jsMaxConcurrentPages" value="3" min="1" max="10">
                        <span class="setting-help">Number of browser pages for parallel JavaScript rendering (higher = faster but more memory)</span>
                    </div>

                    <div class="setting-group" id="jsWarning" style="display: none;">
                        <div style="background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); border-radius: 6px; padding: 12px; color: #fbbf24;">
                            <strong>‚ö†Ô∏è Performance Impact</strong><br>
                            JavaScript rendering is significantly slower than HTTP-only crawling. Use for sites with dynamic content or when static crawling produces incomplete results.
                        </div>
                    </div>
                </div>

                <!-- Issue Exclusion Settings -->
                <div id="issues-settings" class="settings-tab-content">
                    <h3>Issue Exclusion Patterns</h3>
                    <p class="setting-help">URLs matching these patterns will be excluded from issue detection. These are typically admin areas, development files, and framework internals that should never be indexed by search engines.</p>

                    <div class="setting-group">
                        <label for="issueExclusionPatterns">Exclusion Patterns (one per line)</label>
                        <textarea id="issueExclusionPatterns" rows="20" placeholder="/admin/*
/wp-admin/*
*.json"></textarea>
                        <span class="setting-help">Use * for wildcards. Examples: /admin/*, *.json, /test/*</span>
                        <div style="margin-top: 10px;">
                            <button type="button" onclick="resetIssueExclusions()" style="background: #6b7280; padding: 8px 16px; border-radius: 6px; border: none; color: white; cursor: pointer;">
                                Reset to Defaults
                            </button>
                            <span class="setting-help" style="margin-left: 10px;">Restore the default exclusion patterns</span>
                        </div>
                    </div>

                    <div class="setting-group">
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 6px; padding: 12px;">
                            <strong>‚ÑπÔ∏è Default Exclusions Include:</strong><br>
                            ‚Ä¢ WordPress admin areas (/wp-admin/*, /wp-content/plugins/*)<br>
                            ‚Ä¢ Common admin panels (/admin/*, /administrator/*, /cpanel/*)<br>
                            ‚Ä¢ Development files (/.git/*, /node_modules/*, /vendor/*)<br>
                            ‚Ä¢ Build and cache directories (/build/*, /cache/*, /tmp/*)<br>
                            ‚Ä¢ Configuration files (*.json, *.yaml, *.xml)<br>
                            ‚Ä¢ Backup files (*.bak, *.backup, *.old)
                        </div>
                    </div>
                </div>

                <!-- Custom CSS Settings -->
                <div id="customcss-settings" class="settings-tab-content">
                    <h3>Custom CSS Styling</h3>
                    <p class="setting-help">Write custom CSS to personalize the look and feel of the LibreCrawl interface. Changes apply immediately after saving.</p>

                    <div class="setting-group">
                        <label for="customCSS">Custom CSS Code</label>
                        <textarea id="customCSS" rows="20" placeholder="/* Write your custom CSS here */
/* Example: */
/* .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); } */
/* .data-table th { background-color: #4f46e5; } */
/* .btn-primary { background: #10b981; } */"></textarea>
                        <span class="setting-help">Enter valid CSS rules to customize the interface appearance</span>
                    </div>

                    <div class="setting-group">
                        <div style="background: rgba(139, 92, 246, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); border-radius: 6px; padding: 12px;">
                            <strong>üí° CSS Tips:</strong><br>
                            ‚Ä¢ Target specific elements: <code>.header</code>, <code>.data-table</code>, <code>.sidebar</code><br>
                            ‚Ä¢ Change colors: <code>background-color</code>, <code>color</code>, <code>border-color</code><br>
                            ‚Ä¢ Modify spacing: <code>padding</code>, <code>margin</code>, <code>gap</code><br>
                            ‚Ä¢ Adjust fonts: <code>font-family</code>, <code>font-size</code>, <code>font-weight</code><br>
                            ‚Ä¢ Use <code>!important</code> to override default styles if needed<br>
                            ‚Ä¢ Changes only affect the frontend UI
                        </div>
                    </div>

                    <div class="setting-group">
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 6px; padding: 12px;">
                            <strong>üé® Example Customizations:</strong><br><br>
                            <code style="display: block; background: #1f2937; padding: 10px; border-radius: 4px; margin: 8px 0; font-size: 13px; color: #e5e7eb;">
                            /* Dark purple header */<br>
                            .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }<br><br>
                            /* Green accent buttons */<br>
                            .btn-primary { background: #10b981; }<br><br>
                            /* Larger table text */<br>
                            .data-table { font-size: 14px; }
                            </code>
                        </div>
                    </div>
                </div>

                <!-- Advanced Settings -->
                <div id="advanced-settings" class="settings-tab-content">
                    <h3>Advanced Configuration</h3>

                    <div class="setting-group">
                        <label for="concurrency">Concurrent Requests</label>
                        <input type="number" id="concurrency" value="5" min="1" max="50">
                        <span class="setting-help">Number of simultaneous requests (higher = faster but more resource intensive)</span>
                    </div>

                    <div class="setting-group">
                        <label for="memoryLimit">Memory Limit (MB)</label>
                        <input type="number" id="memoryLimit" value="512" min="64" max="4096">
                        <span class="setting-help">Maximum memory usage for crawl data</span>
                    </div>

                    <div class="setting-group">
                        <label for="logLevel">Log Level</label>
                        <select id="logLevel">
                            <option value="DEBUG">Debug</option>
                            <option value="INFO" selected>Info</option>
                            <option value="WARNING">Warning</option>
                            <option value="ERROR">Error</option>
                        </select>
                        <span class="setting-help">Logging verbosity level</span>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="saveSession">
                            Save Session Data
                        </label>
                        <span class="setting-help">Automatically save crawl data between sessions</span>
                    </div>

                    <div class="setting-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="enableProxy">
                            Enable Proxy
                        </label>
                        <span class="setting-help">Route requests through a proxy server</span>
                    </div>

                    <div class="setting-group" id="proxySettings" style="display: none;">
                        <label for="proxyUrl">Proxy URL</label>
                        <input type="text" id="proxyUrl" placeholder="http://proxy.example.com:8080">
                        <span class="setting-help">Proxy server URL with port</span>
                    </div>

                    <div class="setting-group">
                        <label for="customHeaders">Custom Headers</label>
                        <textarea id="customHeaders" rows="4" placeholder="Header-Name: Header-Value&#10;Another-Header: Another-Value"></textarea>
                        <span class="setting-help">Additional HTTP headers to send (one per line)</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="resetSettings()">Reset to Defaults</button>
                <button class="btn btn-secondary" onclick="closeSettings()">Cancel</button>
                <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
            </div>
        </div>
    </div>

    <script src="/static/js/incremental_poller.js"></script>
    <script src="/static/js/virtual-scroller.js"></script>
    <script src="/static/js/column-resize.js"></script>
    <script src="/static/js/visualization.js"></script>
    <script src="/static/js/plugin-loader.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/dashboard.js"></script>
    <script src="/static/js/settings.js"></script>
</body>
</html>
